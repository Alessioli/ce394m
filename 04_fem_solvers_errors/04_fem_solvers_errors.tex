%**************************************************************************************
% License:
% CC BY-NC-SA 4.0 (http://creativecommons.org/licenses/by-nc-sa/4.0/)
%**************************************************************************************

\documentclass[notes]{beamer}

\mode<presentation> {

\usetheme{Madrid}

% Burnt orange
\definecolor{burntorange}{rgb}{0.8, 0.33, 0.0}
\colorlet{beamer@blendedblue}{burntorange}
% Pale yellow
\definecolor{paleyellow}{rgb}{1.0, 1.0, 0.953}
\setbeamercolor{background canvas}{bg=paleyellow}
% Secondary and tertiary palett
\setbeamercolor*{palette secondary}{use=structure,fg=white,bg=burntorange!80!black}
\setbeamercolor*{palette tertiary}{use=structure,fg=white,bg=burntorange!60!black}

% To remove the footer line in all slides uncomment this line
%\setbeamertemplate{footline}
% To replace the footer line in all slides with a simple slide count uncomment this line
%\setbeamertemplate{footline}[page number]

% To remove the navigation symbols from the bottom of all slides uncomment this line
%\setbeamertemplate{navigation symbols}{}
}

\usepackage{amsmath}
\usepackage{bm}
\usepackage{breqn}
\usepackage{graphicx} % for figures
\usepackage{subcaption} % for subplots 
\usepackage[labelsep=space,tableposition=top]{caption}
\renewcommand{\figurename}{Fig.} 
\usepackage{cleveref}
\usepackage{caption,subcaption}% http://ctan.org/pkg/{caption,subcaption}
\usepackage{booktabs} % Allows the use of \toprule, \midrule and \bottomrule in tables
\usepackage{multirow}

% To print 2 slides on a page
%\usepackage{handoutWithNotes}
%\pgfpagesuselayout{2 on 1}[border shrink=2mm]
%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------
% The short title appears at the bottom of every slide, the full title is only on the title page
\title[CE394M: solvers - errors]{CE394M: FEM solvers and errors} 
\author{Krishna Kumar} % name
\institute[UT Austin] % institution 
{
University of Texas at Austin \\
\medskip
\textit{
  \url{krishnak@utexas.edu}} % Your email address
}
\date{\today} % Date, can be changed to a custom date

\begin{document}

\begin{frame}
\titlepage % title page as the first slide
\end{frame}

\begin{frame}
 % Table of contents slide, comment this block out to remove it
 \frametitle{Overview}
 % Throughout your presentation, if you choose to use \section{} and \subsection{} 
 % commands, these %will automatically be printed on this slide as an overview 
 \tableofcontents
\end{frame}

%----------------------------------------------------------------------------------------
% slides
%----------------------------------------------------------------------------------------
\section{Solving non-linear problems}
%------------------------------------------------
\begin{frame}
\frametitle{Linear and non-linear problems}
\begin{itemize}
	\item \textbf{Linear problems}
	\mode<beamer>{
		\begin{itemize}
			\item The response can only be approximated as linear if its
			deformations/motions are small.
			\item In linear analyses, the response to individual load cases can be
			scaled and added to the results from other linear analyses,
			which is the principle of superposition.
		\end{itemize}
	}
	\mode<handout>{
		\vspace{2.5cm}
	}
	%
	\item \textbf{Non-linear problems}
		\mode<beamer>{
		\begin{itemize}
			\item Superposition is invalid.
			\item The solution is an incremental/iterative process.
			\item An iteration is the solution of a system of equations linearised
			about the current state of the nonlinear physical problem.
		\end{itemize}
	}
	\mode<handout>{
		\vspace{2.5cm}
	}
	\end{itemize}
\end{frame}

%------------------------------------------------
\begin{frame}
\frametitle{Non-linearity in geotechnical engineering}
\mode<beamer>{
	\begin{itemize}
		\item \textbf{Material non-linearity}
			\begin{itemize}
				\item plasticity
			\end{itemize}

		\item \textbf{Contact}
			\begin{itemize}
				\item discontinuous source of non-linearity
			\end{itemize}
		
		\item \textbf{Large deformations and motions of a geotechnical structures}
			\begin{itemize}
				\item rotation, rigid body motion
				\item often ignored, still in the research area.
			\end{itemize}
	\end{itemize}
}
\mode<handout>{
	\vspace{3cm}
}
	%
\begin{figure}[ht]
	\centering
	\includegraphics[width=0.85\textwidth]{figs/rotation.png}
	\caption*{No strains if linear strain-displacement relations are used.}
\end{figure}
\end{frame}

%------------------------------------------------
\begin{frame}
\frametitle{Linear solvers}
To solve a system of linear equations of the form $\mathbf{Ka = b}$, there are two families of
methods of solvers that can be used: direct and iterative.
\mode<beamer>{
	\begin{itemize}
		\item Direct solvers solve a system of linear equations in a predefined number of steps. 
		\item Methods are based on Gauss elimination, with the most common method being LU decomposition. 
		\item The time required to solve a linear system increases with the number of computer
		operations performed.
		\item For a direct linear solver applied to a dense system of size $n \times n$: CPU time = $C n^3$.
		\item If the number of degrees of freedom in a finite element simulation is doubled,
		the time required to solve the system will increase by a factor of 8!
	\end{itemize}
}
\mode<handout>{
	\vspace{6cm}
}
\end{frame}
\subsection{Iterative solvers}
%------------------------------------------------
\begin{frame}
\frametitle{Iterative solvers}
The system of equations that we derived from the finite element approximation of the BVP:
\mode<beamer>{
		\begin{equation*}
			F_{\mathrm{int}}(u) - F_{\mathrm{ext}} = 0
		\end{equation*}

At this point we remind ourselves that in the case of finite deformations, both $F_{\mathrm{int}}$ and $F_{\mathrm{ext}}$ are in general very nonlinear terms. 

The integration has to be carried over the current volume and surface (of the finite element under consideration) that may in general depend on $u$ in a highly non-linear fashion.
}
\mode<handout>{
	\vspace{6cm}
}
\end{frame}

\subsection{Tangent stiffness}
%------------------------------------------------
\begin{frame}
\frametitle{Tangent stiffness method}
\mode<beamer>{
	\begin{figure}[ht]
		\centering
		\includegraphics[width=0.65\textwidth]{figs/tangent-stiffness.png}
	\end{figure}
	\begin{itemize}
		\item Many small increments are need to obtain accurate solution
		\item Need to perform a parametric study to find the optimum incremental
		\item Defining increments is very important
		\item Program - SAGE CRISP
	\end{itemize}
}
\mode<handout>{
	\vspace{6cm}
}
\end{frame}
\note{
	In the incremental solution we divide the load into increments $\Delta P = \lambda P$, where $\lambda$ is also known as a load factor and apply a repeated solution of $\Delta u = K^{-1} \Delta P$. \\
	
	Basically we divide the load into substeps, and treat each as linear - but that is usually not accurate enough and inefficient.
}
\subsection{Newton Raphson}
%------------------------------------------------
\begin{frame}
\frametitle{Newton Raphson method}
\mode<beamer>{
	\begin{figure}[ht]
		\centering
		\includegraphics[width=0.5\textwidth]{figs/newton.png}
	\end{figure}
	\begin{equation*}
		x_{n+1} = x_n - \frac{f(x_n)}{f^\prime(x_n)}
	\end{equation*}
}
\mode<handout>{
	\vspace{6cm}
}
\end{frame}

%------------------------------------------------
\begin{frame}
\frametitle{Newton Raphson method}
The incremental loading is expressed as follows. The external load vector $F_{\mathrm{ext}}$ is gradually increased from 0 in order to reach a desired value $\mathbf{F}^*$. Assuming that  $\mathbf{F}^*$ itself remains constant during the analysis in terms of its 'direction' and only its magnitude is changing, we can write $F_{\mathrm{ext}} = q$ known just to simplify our expression for the system of equations. Then we can control how the external load vector increases or decreases by introducing a scalar quantity $\lambda$ and express the system as follows:

\mode<beamer>{
	\begin{equation*}
		R(u) = F_{\mathrm{int}} - F_{\mathrm{ext}} \rightarrow R(u) = F_{\mathrm{int}} - \lambda F_{\mathrm{ext}} = 0
	\end{equation*}
}
\mode<handout>{
\vspace{6cm}
}
	
Thus by increasing or decreasing $\lambda$ we can control our load. We are interested in 
$u$ and $\lambda$. At every increment, we change slightly the value of $\lambda$ and try 
to determine $u$ satisfying $R(u)= 0$.
	
\mode<beamer>{
	\begin{equation*}
		\Delta u = [K_T]^{-1}_{u0} \cdot (\Delta \lambda q)
	\end{equation*}
}
\mode<handout>{
\vspace{6cm}
}
	
\end{frame}

\note {
	where $\left[K^T\right] = [\partial F(u)/ \partial u]$ is the ``Jacobian'' matrix of the system of equations and is commonly referred to as the Stiffness Matrix.
	\begin{figure}[ht]
		\centering
		\includegraphics[width=0.65\textwidth]{figs/newton-raphson-fe.png}
	\end{figure}
}

%------------------------------------------------
\begin{frame}
\frametitle{Newton Raphson method}
\mode<beamer>{
	\begin{figure}[ht]
		\centering
		\includegraphics[width=\textwidth]{figs/newton-raphson.png}
	\end{figure}
	\begin{itemize}
		\item Using the initial stiffness $K_0$, apply an increment of load $\delta P$,
		calculate an approximate solution $c_a$ caused by this increment.
		
		\item The stiffness $K_a$ is updated using the new position, and the
		internal force in the spring $I_a$ is calculated.
		
		\item If the difference $R_a$ between the total load applied to the spring,
		$P$, and $I_a$ is smaller than the tolerance, $u_a = u_0 + c_a$ is the
		converged solution.
	\end{itemize}
}
\mode<handout>{
	\vspace{6cm}
}
\end{frame}

\note{
	\begin{itemize}
		\item If $R_a$ is not small, a new displacement correction $c_b$ is calculated
		by solving $c_b = R_a /K_a$
		\item The new displacement $u_b$ is updated, and the internal force $I_b$ in
		the updated configuration is calculated.
		\item The new force residual $R_b$ is obtained. If $R_b < tolerance$, the
		solution is converged. If not, continue the iteration.
	\end{itemize}
}


%------------------------------------------------
\begin{frame}
\frametitle{Newton Raphson method: Tolerance and Convergence}
\begin{itemize}
	\item Program - ABAQUS
	\item Newton-Raphson is the most standard method to solve nonlinear problems in FE.
	\item A large error in the initial estimate can contribute to non-convergence of the algorithm.
	\item \textbf{Tolerance}
	\begin{itemize}
		\item must be small enough to ensure that the approximate
		solution is close to the exact mathematical solution.
		\item must be large enough so that reasonable number of
		iterations are performed.
	\end{itemize}
	\item \textbf{Quadratic convergence}
	\begin{itemize}
		\item If the tangent stiffness is calculated correctly, $R$ should
		reduce quadratically from one iteration to the next.
	\end{itemize}
\end{itemize}
\end{frame}

%------------------------------------------------
\begin{frame}
\frametitle{Newton Raphson: Drawbacks}
\mode<beamer>{
	\begin{figure}[ht]
		\centering
		\includegraphics[width=\textwidth]{figs/newton-snap-through.png}
	\end{figure}
}
\mode<handout>{
	\vspace{6cm}
}
\end{frame}

\note{
	Newton's method fails to accurately follow the ‘equilibrium’ path once the tangent
	stiffness reaches zero. That happens due to the formulation of Newton’s method, and in particular that it
	restricts the parameter $\lambda$ to change monotonically every increment 3 . The definition of a limit point then (saddle points excluded), suggests that in order to remain on the equilibrium path you need to change your
	loading pattern depending on whether the limit point is a local maximum or maximum in the $u - \lambda$ space.
}

\note{
	In terms of mechanical systems then, this method is able to solve any non-linear system of equations
	very efficiently but only up to the critical point (if any). In the case shown in figure, Newton’s method
	fails in load–control. Now in many cases, one way to circumvent problems like these is to use displacement
	control, where you can continuously increase the displacements u and still remain on the equilibrium curve.
	In general however, apart from Snap–Through behaviors under load control, a problem may exhibit Snap–
	Back behaviors under displacement control or even both. The main problem is, that in
	most actual applications, the structural response, and therefore the equilibrium path, for the structure under
	consideration is unknown, and therefore one does not know what type of behavior to expect.
}
\note{
	 As a general
	rule, if the problem under consideration requires information after its critical/failure points then Newton’s
	method is not a good choice. Buckling analysis and non-linear materials that exhibit work softening are
	just two example problems that cannot be solved using Newton’s method. Furthermore, very often, strong
	nonlinearities that arise in finite deformation problems may eventually lead to such behaviors and thus it is
	necessary to introduce a numerical technique to solve such problem with strongly nonlinear behaviors.
}


%------------------------------------------------
\begin{frame}
\frametitle{Newton Raphson: Drawbacks}
\mode<beamer>{
	\begin{figure}[ht]
		\centering
		\includegraphics[width=0.65\textwidth]{figs/newton-failures.png}
		\caption*{(a) A system that is unstable under load control (Snap–Through instability), (b) A system that is unstable under displacement control (Snap–Back Instability), (c) A system that is unstable under both displacement and load control}
	\end{figure}
}
\mode<handout>{
	\vspace{6cm}
}
\end{frame}

\section{Arc length method}
%------------------------------------------------
\begin{frame}
\frametitle{Arc length method}
System of the non-linear (in general) equations to solve:
\begin{equation*}
	F_{\mathrm{int}} - F_{\mathrm{ext}} = 0 \rightarrow F_{\mathrm{int}} - \lambda q = 0
\end{equation*}

Suppose ($u_0, \lambda_0$) satisfy the system of equations and thus belongs to the `equilibrium path'. Arc Length postulates a simultaneous variation in both the displacements $\Delta u$ and the load vector coefficient $\Delta \lambda$.

\mode<beamer>{
\begin{equation*}
	R(u^\prime, \lambda^\prime) = F_{\mathrm{int}}(u_0 + \Delta u) - (\lambda_0 + \Delta \lambda)q = 0
\end{equation*}


If the above is satisfied for $(u_0 + \Delta u, \lambda_0 + \Delta \lambda)$ then this point also belongs to the ‘equilibrium path’ and we can successfully update the solution. However, immediate satisfaction is not possible, so we need to provide the necessary corrections $(\delta u, \delta \lambda)$, aiming that the new point $(u_0 + \Delta u + \delta u, \lambda_0 + \Delta \lambda + \delta \lambda)$ will satisfy. 


	\begin{equation*}
		R(u^{\prime \prime}, \lambda^{\prime \prime}) = F_{\mathrm{int}}(u_0 + \Delta u + \delta u) - (\lambda_0 + \Delta \lambda+ \delta \lambda)q = 0
	\end{equation*}
	
}
\mode<handout>{
	\vspace{4cm}
}
\end{frame}


\note{
	Arc length is a very efficient method in solving non-linear systems of equations when the problem under consideration exhibits one or more critical points. In terms of a simple mechanical
	loading-unloading problem, a critical point could be interpreted as the point at which the loaded body
	cannot support an increase of the external forces and an instability occurs.\\
	
	Unlike the Newton-Method, the Arc Length method postulates a
	simultaneous variation in both the displacements $\Delta u$ and the load vector coefficient $\Delta lambda$. The main difference is that both $\Delta u$ and $\Delta \lambda$ are unknowns in contrast to Newton’s method where  $\Delta lambda$ was given and we had to iteratively solve for $\Delta u$.
}

\note {
	The system of equations takes the form:
	\begin{equation*}
		\left[K^T \right]_{u_0 + \Delta u} \cdot \delta u - \delta \lambda q = - \left[F_{\mathrm{int}}(u_0 + \Delta u) - (\lambda_0 + \Delta \lambda) q \right] = - R (u^\prime, \lambda^\prime)		
	\end{equation*}
	$\delta u$ and $\delta lambda$ are the unknowns for whom we need to solve. If the $u$ vector however, has dimensions 	$N \times 1$ then we have a total of $N$ equations that we need to solve for $N+1$ unknowns ($N$ unknowns $\delta u$ and 1 unknown $\delta \lambda$). Equations then are not sufficient to determine $\delta u, \delta \lambda$. The supplementary equation that completes the system is called the Arc Length Equation.
	

}

%------------------------------------------------
\begin{frame}
\frametitle{Arc length method}
The Arc length equation:
	\begin{equation*}
		(\Delta \mathbf{u} + \delta \mathbf{u})^T \cdot (\Delta \mathbf{u} + \delta \mathbf{u}) + \psi^2 (\Delta \lambda + \delta \lambda)^2 (\mathbf{q}^T \cdot \mathbf{q}) = \Delta l^2
	\end{equation*}

where $\psi$ and $\Delta l$ are user defined parameters. In a sense $\Delta l$ defines how far to search for the next equilibrium point and it is analogous (but not directly equivalent) to the load increment $\Delta \lambda$ we used in Newton’s method.

\end{frame}

\note {The system of equations is solved for $\delta u, \delta \lambda$ and updates the previous corrections $\Delta u, \Delta \lambda$ to be $\Delta u^\prime = \Delta u + \delta u$ and $\Delta \lambda^\prime = \Delta \lambda + \delta \lambda$ respectively. The method continues to provide such incremental corrections $\delta u, \delta \lambda$ until convergence is achieved. When $\psi = 1$, the method is also called the \textbf{Spherical Arc-Length Method } because the points $\Delta u^\prime, \Delta \lambda^\prime$ belong to a circle with radius $\Delta l$. In its most general form for arbitrary $\psi$ can be geometrically interpreted as a hyper-ellipse in the multidimensional displacement-load space ($u - \lambda$).}


%------------------------------------------------
\begin{frame}
\frametitle{Arc length method}
\mode<beamer>{
	\begin{figure}[ht]
		\centering
		\includegraphics[width=0.65\textwidth]{figs/arc-length-visualized.png}
	\end{figure}
}
\mode<handout>{
	\vspace{6cm}
}
\end{frame}

\note{
	\begin{figure}[ht]
		\centering
		\includegraphics[width=0.8\textwidth]{figs/arc-length.png}
	\end{figure}
}


%------------------------------------------------
\begin{frame}
\frametitle{Arc length method: Drawbacks}
\mode<beamer>{
	\begin{figure}[ht]
		\centering
		\includegraphics[width=\textwidth]{figs/arc-length-failure.png}
	\end{figure}
}
\mode<handout>{
	\vspace{6cm}
}
\end{frame}

\note {
Crisfield’s [1983] implementation of Arc-length however, leads to one of the method’s most important drawbacks. The quadratic equation would in general lead to two distinct solutions for $\delta \lambda$ which will in turn lead to two distinct solutions for $\delta u$. Thus, every iteration, the solver determined two sets of solutions, namely $(\delta u_1, \delta \lambda_1)$ and $(\delta u_1, \delta \lambda_1)$. This is no surprise since a circle (or a hyperellipse) would always intersect a curve in two points if its center is located on the curve.
}

\note {
The issue that arises then, is to develop a robust algorithm that would be able to accurately determine
the correct set of $(\delta u, \delta \lambda)$  to update the solution. In general, we would like to choose the set, so that the solution ‘evolves forwards’. This term ‘forward evolution’ is commonly used in the context of this method since choosing the wrong set would make the solution move back towards a previously converged point, and not in the desired (forward) direction. It is interesting to note, that an effective solution to this problem that works for all applications is yet to be found and as a result, many times programs like ABAQUS fail to converge to the correct solution or fail to ‘evolve forwards’.}
\end{document}